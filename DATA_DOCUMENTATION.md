# 天工开物问答站数据爬取与分析系统 - 文档

## 1. 文件概述

### 1.1 主要功能
该脚本是一个完整的**问答网站数据爬取、清洗、分析系统**，目标网站为：`https://answer.chancefoundation.org.cn/`

### 1.2 系统架构
脚本包含四个主要模块：
- **AnswerSiteCrawler**：网页爬虫，负责数据采集
- **DataAnalyzer**：数据分析器，负责统计和分析
- **DataExporter**：数据导出器，支持多格式输出
- **主程序流程**：调度和控制整个流程

---

## 2. 数据采集详情

### 2.1 爬取数据字段

爬虫从每个问题中提取以下**11个核心字段**：

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **问题ID** | String | 问题的唯一标识符 | "12345" |
| **标题** | String | 问题的完整标题 | "如何学习Python编程?" |
| **提问用户** | String | 提问者的用户名 | "张三" |
| **用户声望** | Integer | 用户在社区的声望值 | 150 |
| **提问时间** | String | 用户友好的时间格式 | "Dec 2, 2025" |
| **精确时间** | String | ISO标准时间格式 | "2025-12-02T10:30:00Z" |
| **点赞数** | Integer | 问题获得的点赞总数 | 45 |
| **回答数** | Integer | 问题获得的回答总数 | 8 |
| **浏览数** | Integer | 问题的浏览总次数 | 1250 |
| **标签** | String | 问题的标签集合（逗号分隔） | "Python, 编程, 初学者" |
| **问题链接** | URL | 问题的完整链接 | "https://answer.chancefoundation.org.cn/questions/12345" |
| **用户链接** | URL | 用户资料的完整链接 | "https://answer.chancefoundation.org.cn/users/123" |
| **抓取时间** | String | 数据抓取时的时间戳 | "2025-01-07 10:30:45" |

### 2.2 爬取规则
- **最大页数**：可配置，默认20页
- **礼貌延迟**：每页间隔1.5秒
- **User-Agent**：模拟Chrome浏览器
- **异常处理**：网络错误自动跳过

### 2.3 数据质量保证
- 自动验证HTML结构
- 异常数据返回默认值（如0、"未知"等）
- 完整的错误日志记录

---

## 3. 数据分析功能

### 3.1 基础统计分析
系统计算以下核心指标：

| 指标 | 计算方式 | 用途 |
|------|---------|------|
| 总问题数 | COUNT(*) | 数据规模 |
| 总浏览数 | SUM(浏览数) | 平台热度 |
| 总点赞数 | SUM(点赞数) | 用户满意度 |
| 总回答数 | SUM(回答数) | 社区活跃度 |
| 平均浏览数 | AVG(浏览数) | 问题吸引力 |
| 平均点赞数 | AVG(点赞数) | 用户评价 |
| 平均回答数 | AVG(回答数) | 问题解决能力 |
| 最大/最小浏览数 | MAX/MIN(浏览数) | 数据分布 |

### 3.2 热门问题分析
- **排序方式**：按浏览数降序
- **输出数量**：Top 10
- **关键指标**：标题、浏览数、点赞数、回答数、提问时间

### 3.3 用户分析
按用户维度聚合统计：

```
用户维度统计 = {
    提问数: COUNT(*)
    总浏览数: SUM(浏览数)
    总点赞数: SUM(点赞数)
    总回答数: SUM(回答数)
    最高声望: MAX(用户声望)
}
```

输出Top 10活跃用户和最高声望用户。

### 3.4 标签分析
- 展开所有问题标签（逗号分隔）
- 按出现频率排序
- 输出Top 10热门标签
- 计算平均每问题标签数

### 3.5 时间分析
- **粒度**：月份级别
- **统计周期**：按"年月"聚合
- **关键指标**：
  - 月度提问数
  - 月度总浏览数
  - 月度总点赞数
  - 最活跃月份识别

### 3.6 页码分布
- 统计每页获取的问题数
- 分析数据分布规律
- 计算平均每页问题数

---

## 4. 数据输出格式

### 4.1 输出文件类型

系统自动生成4种输出文件：

| 格式 | 文件名 | 用途 | 特点 |
|------|--------|------|------|
| **CSV** | `questions_data_full.csv` | Excel/数据库导入 | 开放标准格式 |
| **Excel** | `questions_data_full.xlsx` | 直接打开分析 | 支持格式化 |
| **JSON** | `questions_data_full.json` | API/前端集成 | 嵌套结构 |
| **报告** | `questions_data_full_report.txt` | 人工审阅 | 结构化呈现 |

### 4.2 输出目录结构
```
backendData/
├── input/          # 输入数据目录
└── output/         # 输出数据目录
    ├── questions_data_full.csv
    ├── questions_data_full.xlsx
    ├── questions_data_full.json
    ├── questions_data_full_report.txt
    └── debug_output.txt
```

---

## 5. 数据统计指标汇总

### 5.1 网站整体指标
- 📊 **平台规模**：总问题数、总用户数
- 👥 **用户活跃度**：提问数分布、用户声望分布
- 🔥 **内容热度**：浏览数分布、点赞数分布
- 💬 **社区互动**：回答率、回答数分布
- 🏷️ **内容分类**：标签多样性、热门标签TOP 10
- 📅 **时间维度**：时间序列、最活跃月份、发展趋势

### 5.2 问题质量指标
- 高互动问题：浏览数 > 平均值 * 2
- 低互动问题：浏览数 < 平均值 / 2
- 等待解答：回答数 = 0
- 已解决：回答数 >= 1

---

## 6. 技术实现细节

### 6.1 核心技术栈
- **Web爬取**：requests + BeautifulSoup4
- **数据处理**：pandas
- **时间处理**：datetime + re正则
- **文件导出**：pandas + openpyxl

### 6.2 HTML元素选择器
```
问题容器: div.list-group-item
标题: a.link-dark
用户: a[href*="/users/"]
声望: span[title="Reputation"]
时间: time标签
点赞: i.bi-hand-thumbs-up-fill
回答: i.bi-chat-square-text-fill
浏览: i.bi-eye-fill
标签: a.badge-tag
```

### 6.3 错误处理策略
- 网络超时：记录后跳过
- HTML解析失败：返回默认值
- 数据类型转换：异常时为0或""
- 完整的try-catch框架

---

## 7. 使用建议

### 7.1 爬取建议
- 首次爬取建议：设置 `MAX_PAGES = 5`，测试后再增加
- 定期更新数据：每周运行一次
- 避免高峰期爬取：建议在夜间运行

### 7.2 分析建议
- 关注时间序列变化趋势
- 识别高价值用户
- 分析热点标签变化
- 评估内容质量

### 7.3 数据应用场景
- **内容运营**：识别热门话题方向
- **用户管理**：识别活跃用户、超级用户
- **平台改进**：分析问题解决效率
- **数据报告**：月度/季度数据统计
- **推荐系统**：标签关联分析

---

## 8. 数据样本示例

### 示例问题记录
```
{
    "问题ID": "12345",
    "标题": "Python 中如何高效处理大数据?",
    "提问用户": "数据工程师小李",
    "用户声望": 450,
    "提问时间": "Dec 2, 2025",
    "精确时间": "2025-12-02T10:30:00Z",
    "点赞数": 45,
    "回答数": 8,
    "浏览数": 1250,
    "标签": "Python, 大数据, Pandas, 性能优化",
    "问题链接": "https://answer.chancefoundation.org.cn/questions/12345",
    "用户链接": "https://answer.chancefoundation.org.cn/users/789",
    "抓取时间": "2025-01-07 10:30:45",
    "来源页码": 1
}
```

---

## 9. 已知限制与改进方向

### 9.1 当前限制
- ⚠️ 只爬取列表页，不包含问题详情
- ⚠️ 不包含回答内容全文
- ⚠️ 用户信息仅限基本字段
- ⚠️ 时间格式解析可能不完全

### 9.2 可能的改进
1. 扩展爬取问题详情页（回答内容、评论）
2. 增加用户个人资料深度分析
3. 实现增量爬取（只爬取新增数据）
4. 构建图数据库（用户-问题-标签关系）
5. 添加NLP分析（标题分类、情感分析）

---

## 10. 附录：数据字段完整列表

系统输出的所有字段按类型分类：

### 标识字段
- 问题ID
- 来源页码

### 内容字段
- 标题
- 标签

### 用户字段
- 提问用户
- 用户声望
- 用户链接

### 时间字段
- 提问时间
- 精确时间
- 抓取时间

### 互动指标
- 浏览数
- 点赞数
- 回答数

### 链接字段
- 问题链接
- 用户链接

---

**文档版本**：1.0
**最后更新**：2025-01-07
**数据来源**：https://answer.chancefoundation.org.cn/
